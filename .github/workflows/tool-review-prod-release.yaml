name: tool-review-prod-release
on:
  workflow_call:
    inputs:
      python_version:
        description: "Python version"
        type: string
        required: false
        default: "3.11"
      release_override:
        description: "release version"
        type: string
        required: false
        default: ""
    secrets:
      CONTAINER_REGISTRY_URL:
        required: false
      CONTAINER_REGISTRY_USERNAME:
        required: false
      CONTAINER_REGISTRY_PASSWORD:
        required: false
      GITOPS_KEY:
        required: false
      SOURCE_KEY:
        required: false

env:
  RELEASE_OVERRIDE: ${{ inputs.release_override }}

jobs:
  load-config:
    uses: ./.github/workflows/tool-load-config.yaml

  prod_release:
    uses: ./.github/workflows/tool-gitops-prod-update.yaml
    needs: load-config
    with:
      push_commit: 'true'
      release_tag_override: ${{ inputs.release_override }}
      docker_matrix: ${{ needs.load-config.outputs.docker_matrix }}
      gitops_matrix: ${{ needs.load-config.outputs.gitops_matrix }}
    secrets:
      CONTAINER_REGISTRY_URL: ${{ secrets.CONTAINER_REGISTRY_URL }}
      CONTAINER_REGISTRY_USERNAME: ${{ secrets.CONTAINER_REGISTRY_USERNAME }}
      CONTAINER_REGISTRY_PASSWORD: ${{ secrets.CONTAINER_REGISTRY_PASSWORD }}
      GITOPS_KEY: ${{ secrets.GITOPS_KEY }}
